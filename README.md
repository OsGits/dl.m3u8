# M3U8下载工具脚本说明

## 脚本概述

`dl.m3u8.sh` 是一个功能完整的M3U8资源下载工具，集成了资源下载、环境安装和进程管理三大核心功能。通过直观的菜单界面，用户可以轻松选择所需操作，实现一站式M3U8资源下载解决方案。


## 安装和运行要求

### 操作系统
- Linux系统（推荐Ubuntu 22.04或类似发行版）
- 或Windows Subsystem for Linux (WSL)

### 权限要求
- 运行脚本需要基本执行权限
- 环境安装功能需要root权限

### 初始准备
1. 下载脚本到服务器：
   ```bash
   wget https://raw.githubusercontent.com/OsGits/dl.m3u8/main/dl.m3u8.sh
   ```
   或
   ```bash
   curl -O https://raw.githubusercontent.com/OsGits/dl.m3u8/main/dl.m3u8.sh
   ```

2. 确保脚本具有执行权限：
   ```bash
   chmod +x dl.m3u8.sh
   ```

3. 运行脚本：
   ```bash
   ./dl.m3u8.sh
   ```
   或
   ```bash
   bash dl.m3u8.sh
   ```

## 目录结构

### 主要目录

| 目录路径 | 用途 |
|---------|------|
| `/www/OssOpen/DLoss` | 存储下载完成的视频文件 |
| `/www/OssOpen/TXTOss` | 存储TXT任务文件 |
| `/www/OssOpen/TXTOss/Log` | 存储下载日志和临时文件 |

### 日志文件

- **下载日志**：`/www/OssOpen/TXTOss/Log/download.log`
  - 记录格式：`时间戳:状态:文件名:M3U8_URL`
  - 示例：`2026-01-02 19:30:00:成功:示例视频:http://example.com/video.m3u8`

### 菜单界面

运行脚本后，将显示以下菜单：

```
========================================
          M3U8下载工具菜单
========================================
1: M3u8资源下载
2: 环境一键安装
3: 停止下载进程
4: 退出
========================================
请选择操作 (1-4): 
```

### 操作指南

#### 选择1：M3u8资源下载

1. 输入 `1` 并按Enter键
2. 脚本将自动从指定URL下载TXT任务列表
3. 依次下载每个M3U8资源
4. 显示每个资源的下载状态（成功/失败）
5. 下载完成后，按任意键返回菜单

#### 选择2：环境一键安装

1. 输入 `2` 并按Enter键
2. 脚本将检查是否具有root权限
3. 自动执行环境安装流程
4. 显示安装进度和结果
5. 安装完成后，按任意键返回菜单

#### 选择3：停止下载进程

1. 输入 `3` 并按Enter键
2. 显示当前运行的相关进程
3. 自动终止所有相关进程
4. 清理残留文件
5. 显示终止结果
6. 操作完成后，按任意键返回菜单

#### 选择4：退出

1. 输入 `4` 并按Enter键
2. 退出脚本

## 功能介绍

### 1. M3u8资源下载

从指定的TXT文件链接获取M3U8下载任务列表，自动下载并保存为视频文件。

**主要特点：**
- 自动从远程TXT文件获取下载任务
- 支持多种视频格式输出（MP4、MKV、AVI等）
- 实时显示下载进度和状态
- 自动记录下载日志
- 智能清理临时文件

### 2. 环境一键安装

自动安装M3U8下载所需的所有依赖和工具，包括：

- 系统依赖更新
- .NET Runtime 9.0
- N_m3u8DL-RE下载工具 (来源: https://github.com/nilaoda/N_m3u8DL-RE)
- 必要目录创建

**安装流程：**
1. 更新系统软件包
2. 安装核心依赖（wget、tar、ffmpeg等）
3. 安装.NET Runtime 9.0
4. 下载并安装N_m3u8DL-RE
5. 创建必要的存储目录
6. 验证安装结果

### 3. 停止下载进程

强制终止所有相关下载进程并清理残留文件，确保系统资源释放。

**主要功能：**
- 显示当前运行的相关进程
- 强制终止dl.sh和N_m3u8DL-RE进程
- 清理残留的临时文件和日志
- 验证终止结果
- 提供手动终止指导


## 技术细节

### 核心工具

- **N_m3u8DL-RE**：高性能M3U8下载工具，支持各种加密和直播流 (来源: https://github.com/nilaoda/N_m3u8DL-RE)
- **curl/wget**：用于下载远程TXT文件
- **bash**：脚本执行环境

### 关键参数

- **TXT_URL**：`http://127.0.0.1:10000/down/it9TvaAwEfZz.txt`
  - 可在脚本第8行修改为自定义URL
  - 用于指定包含M3U8下载任务列表的远程TXT文件链接

- **输出目录**：`/www/OssOpen/DLoss`
  - 可在脚本第4行修改
  - 用于存储下载完成的视频文件

- **TXT文件目录**：`/www/OssOpen/TXTOss`
  - 可在脚本第6行修改
  - 用于存储TXT任务文件

- **日志目录**：`/www/OssOpen/TXTOss/Log`
  - 可在脚本第11行修改
  - 用于存储下载日志和临时文件
  - 注意：此参数依赖于TXT文件目录，建议不要直接修改

## 常见问题

### 1. 脚本无法运行

**问题**：运行脚本时提示"bash: ./dl.m3u8.sh: 权限不够"

**解决方法**：
```bash
chmod +x dl.m3u8.sh
```

### 2. 环境安装失败

**问题**：选择环境安装时提示"错误：需要以root权限运行此安装脚本！"

**解决方法**：
```bash
sudo ./dl.m3u8.sh
```

### 3. 下载失败

**可能原因**：
- M3U8链接失效
- 网络连接问题
- N_m3u8DL-RE工具未正确安装

**解决方法**：
- 检查TXT文件中的M3U8链接是否有效
- 确保网络连接正常
- 重新运行环境安装功能

### 4. 进程无法停止

**问题**：选择停止进程后仍有相关进程运行

**解决方法**：
- 根据脚本提示的PID，手动执行：
  ```bash
  kill -9 PID
  ```
- 示例：`kill -9 1234`

## 安全注意事项

1. 仅从可信来源获取M3U8资源
2. 定期清理日志和临时文件
3. 避免长时间运行大量下载任务
4. 定期更新系统和依赖

## 版本信息

- 脚本版本：1.1
- 集成工具：N_m3u8DL-RE v0.5.1-beta
- 支持平台：Linux/Ubuntu 22.04+

## 脚本文件说明

| 脚本文件 | 功能描述 |
|---------|---------|
| `dl.m3u8.sh` | 主菜单脚本，集成所有功能 |
| `dl.sh` | 原M3U8下载脚本（已集成） |
| `an.dl.m3u8.sh` | 原环境安装脚本（已集成） |
| `tdl.sh` | 原进程停止脚本（已集成） |




---

**注意**：本脚本仅供学习和研究使用，请遵守相关法律法规，合理使用网络资源。
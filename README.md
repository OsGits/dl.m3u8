# M3U8下载工具脚本说明

## 脚本概述

`dl.sh` 是一个功能完整的M3U8资源下载工具，集成了资源下载、环境安装和进程管理三大核心功能。通过直观的菜单界面，用户可以轻松选择所需操作，实现一站式M3U8资源下载解决方案。


## 安装和运行要求

### 操作系统
- Linux系统（推荐Ubuntu 22.04或类似发行版）
- 其它版本未尝试

### 权限要求
- 运行脚本需要基本执行权限
- 环境安装功能需要root权限

### 初始准备
1. 一键运行：
   ```bash
   wget https://raw.githubusercontent.com/OsGits/dl.m3u8/main/dl.sh
   chmod +x dl.sh
   ./dl.sh
   ```
   - 首次安装：
     - 必须先运行菜单5，完成环境安装/更新
     - 再运行菜单4，进行使用配置
     - 完成后，即可运行菜单1进行下载
2. 后期如需要使用，运行   
   ```bash
   ./dl.sh
   ```
   即可直接使用，无需重新配置环境。
   菜单中可修改下载目录、临时文件目录、TXT文件URL等配置。



## 目录结构

### 主要目录(菜单中可修改)

| 目录路径 | 用途 |
|---------|------|
| `/www/OssOpen/DLoss` | 存储下载完成的视频文件 |
| `/www/OssOpen/TXTOss` | 存储TXT任务文件 |
| `/www/OssOpen/TXTOss/Log` | 存储下载日志和临时文件 |

### 日志文件

- **下载日志**：
  - 记录格式：`时间戳:状态:文件名:M3U8_URL`
  - 示例：`2026-01-02 19:30:00:成功:示例视频:http://example.com/video.m3u8`

### 菜单界面

运行脚本后，将显示以下菜单：

```
========================================
1: M3u8资源下载
2: 查看下载进程
3: 清除缓存文件(不删视频只删临时文件)
4: 使用配置(首次使用第2步,更新不用)
5: 安装/更新 (首次使用第1步)
6: 停止下载进程
7: 删除脚本(谨慎操作)
8: 退出
========================================
请选择操作 (1-8): 
```

### 操作指南

#### 须知
###### 重要说明：
  - 首次使用前，必须先运行菜单5和菜单4完成环境配置。  
  - 在下载的m3u8资源中，`有的资源中对视频进行地区限制，或者IP白名单，需要去联系资源提供者获取权限`。

#### 选择1：M3u8资源下载

1. 输入 `1` 并按Enter键
2. 脚本将自动从指定URL下载TXT任务列表
3. 依次下载每个M3U8资源
4. 显示每个资源的下载状态（成功/失败）
5. 实时清理临时日志文件
6. 下载完成后，显示下载结果和日志文件位置
7. 按任意键返回菜单

#### 选择2：查看下载进程

1. 输入 `2` 并按Enter键
2. 查看当前下载进程的日志信息
3. 显示最近20行的nohup.out日志文件内容
4. 按任意键返回菜单

#### 选择3：清除缓存文件(不删视频只删临时文件)

1. 输入 `3` 并按Enter键
2. 显示当前配置信息（下载目录、临时文件目录）
3. 自动清理以下临时文件：
   - /root目录下的nohup.out文件
   - 当前目录下的nohup.out文件
   - download.log日志文件
   - /usr/local/bin/Logs目录下的日志和临时文件
   - 日志目录下的所有临时文件
   - 日志目录下以视频名命名的临时文件夹
   - /root目录下的临时文件夹
4. 显示删除的文件列表、大小和总删除大小
5. 按任意键返回菜单

#### 选择4：使用配置(首次使用第2步,更新不用)

1. 输入 `4` 并按Enter键
2. 显示当前配置信息（下载目录、临时文件目录、TXT文件URL）
3. 可选择修改各项配置：
   - 下载完成后储存的目录
   - 使用过程中产生的临时文件和日志目录
   - 需要进行下载的TXT文件URL
4. 支持直接回车使用默认值
5. 配置保存到DLfile.sh文件并复制到/root目录
6. 更新N_m3u8DL-RE.sh配置
7. 配置保存后显示新配置信息
8. 按任意键返回菜单

#### 选择5：安装/更新 (首次使用第1步)

1. 输入 `5` 并按Enter键
2. 脚本将检查是否具有root权限
3. 自动执行环境安装流程：
   - 更新系统并安装核心依赖（wget、tar、ffmpeg、libgdiplus）
   - 安装.NET Runtime 9.0
   - 下载并安装N_m3u8DL-RE程序
   - 下载并覆盖N_m3u8DL-RE.sh脚本到/root目录
   - 下载并覆盖当前dl.sh脚本
4. 显示安装进度和结果
5. 安装完成后显示版本信息
6. 按任意键返回菜单

#### 选择6：停止下载进程

1. 输入 `6` 并按Enter键
2. 显示当前运行的相关进程
3. 自动终止所有相关进程（dl.sh、N_m3u8DL-RE、bash进程）
4. 清理残留的临时文件：
   - 清理日志目录下的临时文件
   - 清理/usr/local/bin/Logs目录下的临时文件
   - 清理/root/目录下的临时文件夹（仅当对应视频文件已存在时）
5. 显示终止结果和最终状态
6. 按任意键返回菜单

#### 选择7：删除脚本(谨慎操作)

1. 输入 `7` 并按Enter键
2. 显示警告信息，提示将删除的内容
3. 要求输入'YES'确认删除，输入其他内容取消
4. 执行删除操作：
   - 删除N_m3u8DL-RE程序
   - 卸载ffmpeg及相关依赖
   - 删除当前脚本文件
   - 删除DLfile.sh配置文件（本地和/root目录）
5. 执行完成后自动退出

#### 选择8：退出

1. 输入 `8` 并按Enter键
2. 退出脚本



---

**注意**：本脚本仅供学习和研究使用，请遵守相关法律法规，合理使用网络资源。